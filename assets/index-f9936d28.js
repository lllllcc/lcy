import{d as T,L as j,r as b,M as G,c as i,e as y,f as e,w as r,F as v,o as m,A as V,B as k,i as c,h,k as f,x as H,q as x,y as L,N as K,J as p,v as w,O as Q,t as R}from"./index-2f7bbdd9.js";const W=["onClick"],X={name:"attr"},ee=T({...X,setup(Y){const t=j(),A=()=>{t.scene=!t.scene,l.value.categoryId=t.C3id},$=()=>{t.scene=!t.scene},B=()=>{t.scene=!t.scene,l.value={attrName:"",categoryId:"",categoryLevel:3,attrValueList:[]}};let l=b({attrName:"",categoryId:"",categoryLevel:3,attrValueList:[]});const O=async()=>{(await K(l.value)).code===200?(t.scene=!t.scene,t.attrInfoList(),p({type:"success",message:l.value.id?"修改成功":"添加成功"})):(t.scene=!t.scene,p({type:"error",message:l.value.id?"修改失败":"添加失败"})),l.value={attrName:"",categoryId:"",categoryLevel:3,attrValueList:[]}},S=()=>{l.value.attrValueList.push({valueName:"",flag:!0}),w(()=>{_.value[_.value.length-1].focus()})},D=n=>{l.value.attrValueList.splice(n,1)},I=(n,o)=>{if(n.valueName.trim()==="")p({type:"error",message:"属性值不能为空"}),l.value.attrValueList.splice(o,1);else{let g=!0;for(let s=0;s<l.value.attrValueList.length;s++)if(l.value.attrValueList[s].valueName===n.valueName&&o!=s){g=!1;break}g==!1&&(l.value.attrValueList.splice(o,1),p({type:"error",message:"属性值不能重复"})),n.flag=!n.flag}},U=(n,o)=>{n.flag=!n.flag,w(()=>{_.value[o].focus()}),console.log(o)};let _=b([]);const z=n=>{t.scene=!t.scene,Object.assign(l.value,JSON.parse(JSON.stringify(n)))},E=async n=>{console.log(n);let o=await Q(n);o.code===200?(p({type:"success",message:"删除成功"}),t.attrInfoList()):p({type:"error",message:`${o.message}`})};return G(()=>{t.$reset()}),(n,o)=>{const g=i("Category"),s=i("el-button"),d=i("el-table-column"),P=i("el-tag"),q=i("el-popconfirm"),C=i("el-table"),N=i("el-input"),J=i("el-form-item"),M=i("el-form"),F=i("el-card");return m(),y(v,null,[e(g),e(F,{style:{margin:"10px 0"}},{default:r(()=>[V(h("div",null,[e(s,{type:"primary",size:"default",icon:"Plus",disabled:!c(t).C3id,onClick:A},{default:r(()=>[f("添加属性")]),_:1},8,["disabled"]),e(C,{border:"",style:{margin:"10px 0"},data:c(t).allAttr},{default:r(()=>[e(d,{label:"序号",type:"index",width:"80px",align:"center"}),e(d,{label:"属性名称",width:"120px",prop:"attrName",align:"center"}),e(d,{label:"属性值名称"},{default:r(a=>[(m(!0),y(v,null,H(a.row.attrValueList,u=>(m(),y(v,{key:u.id},[u.valueName?(m(),x(P,{key:0,style:{"margin-left":"10px"}},{default:r(()=>[f(L(u.valueName),1)]),_:2},1024)):R("",!0)],64))),128))]),_:1}),e(d,{label:"操作",width:"150px",align:"center"},{default:r(a=>[e(s,{icon:"Edit",size:"small",onClick:u=>z(a.row)},null,8,["onClick"]),e(q,{title:`确定要删除${a.row.attrName}吗?`,onConfirm:u=>E(a.row.id)},{reference:r(()=>[e(s,{icon:"Delete",size:"small",type:"danger"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[k,c(t).scene===!0]]),V(h("div",null,[e(M,null,{default:r(()=>[e(J,{label:"属性名称",style:{width:"300px"}},{default:r(()=>[e(N,{placeholder:"请输入属性名称",modelValue:c(l).attrName,"onUpdate:modelValue":o[0]||(o[0]=a=>c(l).attrName=a)},null,8,["modelValue"])]),_:1}),e(s,{type:"primary",icon:"Plus",disabled:!c(l).attrName,onClick:S},{default:r(()=>[f(" 添加属性值 ")]),_:1},8,["disabled"]),e(s,{onClick:$},{default:r(()=>[f("取消")]),_:1}),e(C,{data:c(l).attrValueList,border:"",style:{width:"100%",margin:"15px 0px 15px 0px"}},{default:r(()=>[e(d,{type:"index",label:"序号",width:"80",align:"center"}),e(d,{label:"属性值名称"},{default:r(a=>[a.row.flag?(m(),x(N,{key:0,placeholder:"请输入属性值名称",modelValue:a.row.valueName,"onUpdate:modelValue":u=>a.row.valueName=u,onBlur:u=>I(a.row,a.$index),ref:u=>{c(_)[a.$index]=u}},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(m(),y("div",{key:1,onClick:u=>U(a.row,a.$index)},L(a.row.valueName),9,W))]),_:1}),e(d,{label:"属性值操作"},{default:r(a=>[e(s,{icon:"Delete",type:"danger",onClick:u=>D(a.$index)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(s,{type:"primary",onClick:O,disabled:!(c(l).attrValueList.length>0)},{default:r(()=>[f("保存")]),_:1},8,["disabled"]),e(s,{size:"default",onClick:B},{default:r(()=>[f("取消")]),_:1})]),_:1})],512),[[k,c(t).scene===!1]])]),_:1})],64)}}});export{ee as default};
