import{I as h,m as ne,d as te,r as _,c as d,o as v,q as w,w as l,f as e,e as B,x as J,F as K,h as M,k as P,P as re,J as U,n as ee,Q as de,i as A,R as X,S as ie,v as pe,y as ce,L as me,G as _e,A as Y,B as Z,K as ge}from"./index-34d90912.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";const fe=(f,y,r)=>h.get(`/admin/product/${f}/${y}?category3Id=${r}`),ve=()=>h.get("/admin/product/baseTrademark/getTrademarkList"),se=f=>h.get(`/admin/product/spuImageList/${f}`),ue=f=>h.get(`/admin/product/spuSaleAttrList/${f}`),ke=()=>h.get("/admin/product/baseSaleAttrList"),Se=f=>h.post("/admin/product/saveSpuInfo",f),Ve=f=>h.post("/admin/product/updateSpuInfo",f),be=f=>h.post("/admin/product/saveSkuInfo",f),Ie=f=>h.get(`/admin/product/findBySpuId/${f}`),ye=f=>h.delete(`/admin/product/deleteSpu/${f}`),Ae=ne("useSpu",{state:()=>({SpuView:0,trademarkList:[],spuId:0,ImageList:[],AttrList:[],BaseAttrList:[]}),actions:{},getters:{}}),le=Ae,we=["src"],Le={name:"skuForm"},Ce=te({...Le,setup(f,{expose:y}){const r=le(),o=_([]),L=_([]),D=_([]),i=_({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});let $=_();const x=()=>{r.SpuView=0,i.value={category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}},q=async(b,m,g)=>{let p=await re(b,m,g.category3Id);p.code===200?o.value=p.data:U({type:"error",message:p.message});let S=await se(g.id);S.code===200?L.value=S.data:U({type:"error",message:S.message});let I=await ue(g.id);I.code===200?D.value=I.data:U({type:"error",message:I.message}),i.value.category3Id=g.category3Id,i.value.tmId=g.tmId,i.value.spuId=g.id},O=b=>{L.value.forEach(m=>{$.value.toggleRowSelection(m,!1)}),$.value.toggleRowSelection(b,!0),i.value.skuDefaultImg=b.imgUrl},j=async()=>{let b=o.value.reduce((p,S)=>{if(S.attrIdAndValueId){let[I,V]=S.attrIdAndValueId.split(":");p.push({attrId:I,valueId:V})}return p},[]);i.value.skuAttrValueList=b;let m=D.value.reduce((p,S)=>{if(S.saleIdAndValueId){let[I,V]=S.saleIdAndValueId.split(":");p.push({saleAttrId:I,saleAttrValueId:V})}return p},[]);i.value.skuSaleAttrValueList=m;let g=await be(i.value);g.code===200?U({type:"success",message:g.message}):U({type:"error",message:g.message}),r.SpuView=0,i.value={category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}};return y({getSku:q}),(b,m)=>{const g=d("el-input"),p=d("el-form-item"),S=d("el-option"),I=d("el-select"),V=d("el-form"),N=d("el-table-column"),F=d("el-button"),a=d("el-table");return v(),w(V,null,{default:l(()=>[e(p,{label:"sku名称"},{default:l(()=>[e(g,{placeholder:"请输入sku名称",modelValue:i.value.skuName,"onUpdate:modelValue":m[0]||(m[0]=t=>i.value.skuName=t)},null,8,["modelValue"])]),_:1}),e(p,{label:"价格(元)"},{default:l(()=>[e(g,{placeholder:"价格(元)",modelValue:i.value.price,"onUpdate:modelValue":m[1]||(m[1]=t=>i.value.price=t)},null,8,["modelValue"])]),_:1}),e(p,{label:"重量(克)"},{default:l(()=>[e(g,{placeholder:"重量(克)",modelValue:i.value.weight,"onUpdate:modelValue":m[2]||(m[2]=t=>i.value.weight=t)},null,8,["modelValue"])]),_:1}),e(p,{label:"sku描述"},{default:l(()=>[e(g,{autosize:"",type:"textarea",placeholder:"sku描述",modelValue:i.value.skuDesc,"onUpdate:modelValue":m[3]||(m[3]=t=>i.value.skuDesc=t)},null,8,["modelValue"])]),_:1}),e(p,{label:"平台属性"},{default:l(()=>[e(V,{inline:!0},{default:l(()=>[(v(!0),B(K,null,J(o.value,t=>(v(),w(p,{label:t.attrName,key:t.id,"label-width":"4em"},{default:l(()=>[e(I,{modelValue:t.attrIdAndValueId,"onUpdate:modelValue":c=>t.attrIdAndValueId=c},{default:l(()=>[(v(!0),B(K,null,J(t.attrValueList,c=>(v(),w(S,{value:`${t.id}:${c.id}`,label:c.valueName,key:c.id},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"销售属性"},{default:l(()=>[e(V,{inline:!0},{default:l(()=>[(v(!0),B(K,null,J(D.value,t=>(v(),w(p,{label:t.saleAttrName,key:t.id,"label-width":"4em"},{default:l(()=>[e(I,{modelValue:t.saleIdAndValueId,"onUpdate:modelValue":c=>t.saleIdAndValueId=c},{default:l(()=>[(v(!0),B(K,null,J(t.spuSaleAttrValueList,c=>(v(),w(S,{label:c.saleAttrValueName,key:c.id,value:`${t.id}:${c.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(p,{label:"图片名称"},{default:l(()=>[e(a,{border:"",data:L.value,ref_key:"table",ref:$},{default:l(()=>[e(N,{type:"selection",width:"80px",align:"center"}),e(N,{label:"图片"},{default:l(t=>[M("img",{src:t.row.imgUrl,alt:"图片加载失败了",style:{width:"100px",height:"100px"}},null,8,we)]),_:1}),e(N,{label:"名称",prop:"imgName"}),e(N,{label:"操作"},{default:l(t=>[e(F,{type:"warning",size:"small",onClick:c=>O(t.row)},{default:l(()=>[P("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(p,{"label-width":"4.5em"},{default:l(()=>[e(F,{type:"primary",onClick:j},{default:l(()=>[P("保存")]),_:1}),e(F,{onClick:x},{default:l(()=>[P("取消")]),_:1})]),_:1})]),_:1})}}}),Ue=["src"],he={name:"sku"},$e=te({...he,props:{propData:{},rowId:{}},emits:["success"],setup(f,{emit:y}){const r=le(),o=_({category3Id:"",description:"",spuImageList:[],spuName:"",spuSaleAttrList:[],tmId:""}),L=f,D=y;ee(()=>L.propData,a=>{a&&(Object.assign(o.value,JSON.parse(JSON.stringify(a))),o.value.spuImageList=r.ImageList,i.value=o.value.spuImageList.map(t=>({name:t.imgName,url:t.imgUrl,id:t.id,spuId:t.spuId})))}),ee(()=>r.AttrList,a=>{a&&(o.value.spuSaleAttrList=a)});const i=_([]),$=_(""),x=_(!1),q=(a,t)=>{console.log(a,t)},O=a=>{$.value=a.url,x.value=!0},j=()=>{r.SpuView=0},b=()=>{o.value.spuImageList=i.value.map(a=>({imgName:a.name,imgUrl:a.url,id:a.id,spuId:a.spuId})),o.value.id!==void 0?Ve(o.value).then(a=>{a.code===200?(D("success"),r.SpuView=0):U({type:"error",message:a.message})}):Se(o.value).then(a=>{a.code===200?(D("success"),r.SpuView=0):U({type:"error",message:a.message})})},m=_(),g=(a,t)=>{a.splice(t,1)},p=a=>{a.inputVisible=!0,pe(()=>{m.value.input.focus()})},S=a=>{console.log(123),a.inputValue&&a.spuSaleAttrValueList.push({baseSaleAttrId:a.baseSaleAttrId,spuId:a.spuId,saleAttrName:a.saleAttrName,saleAttrValueName:a.inputValue,isChecked:null}),a.inputVisible=!1,a.inputValue=""},I=a=>{o.value.spuSaleAttrList.splice(a,1)},V=_({name:"",id:-1}),N=de(()=>{var c;if(!((c=o.value.spuSaleAttrList)!=null&&c.length))return r.BaseAttrList;const a=[],t=[];for(let s=0;s<o.value.spuSaleAttrList.length;s++)a.push(o.value.spuSaleAttrList[s].saleAttrName);for(let s=0;s<r.BaseAttrList.length;s++)a.includes(r.BaseAttrList[s].name)||t.push(r.BaseAttrList[s]);return t}),F=()=>{o.value.spuSaleAttrList.push({saleAttrName:V.value.name,spuSaleAttrValueList:[],baseSaleAttrId:V.value.id,spuId:L.rowId}),V.value={name:"",id:-1}};return(a,t)=>{const c=d("el-form-item"),s=d("el-option"),u=d("el-select"),H=d("Plus"),T=d("el-icon"),C=d("el-upload"),Q=d("el-dialog"),E=d("el-button"),R=d("el-table-column"),W=d("el-tag"),k=d("el-table"),G=d("el-form");return v(),w(G,null,{default:l(()=>[e(c,{label:"SPU名称","label-width":"7em"},{default:l(()=>[e(A(X),{placeholder:"请输入SPU名称",modelValue:o.value.spuName,"onUpdate:modelValue":t[0]||(t[0]=n=>o.value.spuName=n)},null,8,["modelValue"])]),_:1}),e(c,{label:"SPU品牌","label-width":"7em"},{default:l(()=>[e(u,{modelValue:o.value.tmId,"onUpdate:modelValue":t[1]||(t[1]=n=>o.value.tmId=n),placeholder:"请选择品牌",size:"default"},{default:l(()=>[(v(!0),B(K,null,J(A(r).trademarkList,n=>(v(),w(s,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"SPU描述","label-width":"7em"},{default:l(()=>[e(A(X),{modelValue:o.value.description,"onUpdate:modelValue":t[2]||(t[2]=n=>o.value.description=n),rows:2,type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(c,{label:"SPU照片","label-width":"7em"},{default:l(()=>[e(C,{"file-list":i.value,"onUpdate:fileList":t[3]||(t[3]=n=>i.value=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":O,"on-remove":q},{default:l(()=>[e(T,null,{default:l(()=>[e(H)]),_:1})]),_:1},8,["file-list"]),e(Q,{modelValue:x.value,"onUpdate:modelValue":t[4]||(t[4]=n=>x.value=n)},{default:l(()=>[M("img",{"w-full":"",src:$.value,alt:"Preview Image"},null,8,Ue)]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"SPU销售属性"},{default:l(()=>[e(u,{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=n=>V.value=n),"value-key":"name",placeholder:`还有${N.value.length}未选择`,size:"default",style:{"margin-right":"10px"}},{default:l(()=>[(v(!0),B(K,null,J(N.value,n=>(v(),w(s,{key:n.id,label:n.name,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(E,{type:"primary",icon:"Plus",onClick:F},{default:l(()=>[P("添加销售属性")]),_:1}),e(k,{border:"",style:{width:"100%",margin:"10px 0px"},data:o.value.spuSaleAttrList},{default:l(()=>[e(R,{label:"序号",width:"80px",align:"center",type:"index"}),e(R,{label:"属性名",prop:"saleAttrName",width:"120px",align:"center"}),e(R,{label:"属性值"},{default:l(n=>[(v(!0),B(K,null,J(n.row.spuSaleAttrValueList,(z,oe)=>(v(),w(W,{key:z.id,class:"mx-1",closable:"","disable-transitions":!1,onClose:Be=>g(n.row.spuSaleAttrValueList,oe)},{default:l(()=>[P(ce(z.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.row.inputVisible?(v(),w(A(X),{key:0,ref_key:"InputRef",ref:m,modelValue:n.row.inputValue,"onUpdate:modelValue":z=>n.row.inputValue=z,class:"ml-1 w-20",size:"small",onKeyup:ie(z=>S(n.row),["enter"]),onBlur:z=>S(n.row)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(v(),w(E,{key:1,class:"button-new-tag ml-1",size:"small",onClick:z=>p(n.row)},{default:l(()=>[P(" 添加属性 ")]),_:2},1032,["onClick"]))]),_:1}),e(R,{label:"操作"},{default:l(n=>[e(E,{type:"danger",icon:"Delete",size:"small",onClick:z=>I(n.$index)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(c,{"label-width":"7em"},{default:l(()=>[e(E,{type:"primary",onClick:b},{default:l(()=>[P("保存")]),_:1}),e(E,{onClick:j},{default:l(()=>[P("取消")]),_:1})]),_:1})]),_:1})}}});const xe=ae($e,[["__scopeId","data-v-7edeca54"]]),Ne={class:"demo-pagination-block"},Pe=["src"],De={name:"spu"},ze=te({...De,setup(f){const y=me(),r=le(),o=_(1),L=_(3),D=_(!0),i=_(!1);let $=_();const x=_(),q=_(-1),O=_();let j=_([]),b=_(!1);ee(()=>y.C3id,()=>{g.value=[],y.C3id&&m()});const m=async(s=1)=>{o.value=s;let u=await fe(o.value,L.value,y.C3id);u.code===200?(g.value=u.data.records,$.value=u.data.total):console.log("spu请求失败")};let g=_([]);const p=()=>{r.SpuView=1,x.value={category3Id:y.C3id,description:"",spuImageList:[],spuName:"",spuSaleAttrList:[],tmId:""},q.value=-1,r.ImageList.length=0,r.AttrList.length=0,V(),I()},S=async s=>{r.SpuView=1,await N(s.id),I(),F(s.id),V(),x.value=s,q.value=s.id},I=async()=>{let s=await ve();s.code===200?r.trademarkList=s.data:console.log("品牌列表获取失败")},V=async()=>{let s=await ke();s.code===200?r.BaseAttrList=s.data:console.log("错误")},N=async s=>{let u=await se(s);u.code===200?r.ImageList=u.data:console.log("品牌图片获取失败")},F=async s=>{let u=await ue(s);u.code===200?(r.AttrList=u.data,console.log(r.AttrList)):console.log("销售属性获取失败")},a=s=>{r.SpuView=2,O.value.getSku(y.C1id,y.C2id,s)},t=async s=>{let u=await Ie(s.id);u.code===200?(b.value=!0,j.value=u.data):U({type:"error",message:u.message})},c=async s=>{let u=await ye(s.id);u.code===200?(U({type:"success",message:u.message}),m(o.value)):U({type:"error",message:u.message})};return _e(()=>{y.$reset()}),(s,u)=>{const H=d("Category"),T=d("el-button"),C=d("el-table-column"),Q=d("el-table"),E=d("el-pagination"),R=d("el-dialog"),W=d("el-card");return v(),B(K,null,[e(H),e(W,{style:{margin:"10px 0"}},{default:l(()=>[Y(M("div",null,[e(T,{type:"primary",icon:"Plus",disabled:!A(y).C3id,onClick:p},{default:l(()=>[P("添加spu")]),_:1},8,["disabled"]),e(Q,{border:"",style:{margin:"10px 0"},data:A(g)},{default:l(()=>[e(C,{label:"序号",type:"index",width:"80px",align:"center"}),e(C,{label:"SPU名称",prop:"spuName","show-overflow-tooltip":""}),e(C,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(C,{label:"操作"},{default:l(k=>[e(T,{type:"primary",icon:"Plus",size:"small",title:"添加SKU",onClick:G=>a(k.row)},null,8,["onClick"]),e(T,{type:"primary",icon:"Edit",size:"small",title:"修改SKU",onClick:G=>S(k.row)},null,8,["onClick"]),e(T,{type:"primary",icon:"View",size:"small",title:"查看SKU",onClick:G=>t(k.row)},null,8,["onClick"]),e(T,{type:"primary",icon:"Delete",size:"small",title:"删除SKU",onClick:G=>c(k.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),M("div",Ne,[e(E,{"current-page":o.value,"onUpdate:currentPage":u[0]||(u[0]=k=>o.value=k),"page-size":L.value,"onUpdate:pageSize":u[1]||(u[1]=k=>L.value=k),"page-sizes":[3,6,9,12],disabled:i.value,background:D.value,layout:"prev, pager, next, jumper,->,sizes,total",total:A($),onCurrentChange:u[2]||(u[2]=k=>m(o.value)),onSizeChange:u[3]||(u[3]=k=>m())},null,8,["current-page","page-size","disabled","background","total"])])],512),[[Z,A(r).SpuView===0]]),Y(e(xe,{propData:x.value,rowId:q.value,onSuccess:u[4]||(u[4]=k=>m())},null,8,["propData","rowId"]),[[Z,A(r).SpuView===1]]),Y(e(Ce,{ref_key:"refSku",ref:O},null,512),[[Z,A(r).SpuView===2]]),e(R,{title:"SKU列表","align-center":"",modelValue:A(b),"onUpdate:modelValue":u[5]||(u[5]=k=>ge(b)?b.value=k:b=k)},{default:l(()=>[e(Q,{border:"",data:A(j)},{default:l(()=>[e(C,{label:"sku名字",prop:"skuName"}),e(C,{label:"sku价格",prop:"price"}),e(C,{label:"sku重量",prop:"weight"}),e(C,{label:"sku图片"},{default:l(k=>[M("img",{src:k.row.skuDefaultImg,alt:"图片加载失败了",style:{width:"100px",height:"100px"}},null,8,Pe)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const Fe=ae(ze,[["__scopeId","data-v-812ac7dc"]]);export{Fe as default};
