import{I as V,d as ve,r,D as fe,J as g,c as v,e as j,f as a,w as l,F as B,o as S,k as c,i as u,h as A,K as L,q as O,t as ge,x as _e,v as F,y as ye}from"./index-2f7bbdd9.js";import{_ as be}from"./plugin-vueexport-helper-c27b6911.js";const we=(d,U,C="")=>V.get(`/admin/acl/user/${d}/${U}/?username=${C}`),ke=d=>d.id?V.put("/admin/acl/user/update",d):V.post("/admin/acl/user/save",d),Ve=d=>V.get(`/admin/acl/user/toAssign/${d}`),Ce=d=>V.post("/admin/acl/user/doAssignRole",d),xe=d=>V.delete(`/admin/acl/user/remove/${d}`),Ue=d=>V.delete("/admin/acl/user/batchRemove",{data:d}),he={class:"demo-pagination-block"},$e={class:"checkbox11"},ze={name:"user"},qe=ve({...ze,setup(d){const U=r(!0),C=r(!1),h=r("");let D=r(),s=r({username:"",password:"",name:""});const m=r(1),p=r(5),M=r(!0),Z=r(!1);let b=r(!1),k=r(!1);const w=r(),$=r([]),x=r([]),G={name:[{required:!0,message:"请输入用户昵称,5-8位且不能出现数字",trigger:"blur",validator:(t,e,n)=>{if(/^[a-zA-Z\u4e00-\u9fa5]{5,7}$/.test(e))return n();n(new Error("必须大于5位"))}}],username:[{required:!0,message:"请输入用户名字,5-8位且不能出现数字",trigger:"blur",validator:(t,e,n)=>{if(/^[a-zA-Z\u4e00-\u9fa5]{5,7}$/.test(e))return n();n(new Error("必须大于5位"))}}],password:[{required:!0,min:6,max:12,message:"密码必须大于6位小于12位数",trigger:"blur"}]},J=async t=>{p.value=t,await _(m.value,p.value)},K=async t=>{m.value=t,await _(m.value,p.value)};fe(async()=>{await _(m.value,p.value)});const _=async(t,e,n)=>{let i=await we(t,e,n);i.code===200?D.value=i.data:g({type:"error",message:"数据加载失败"})},H=t=>{b.value=!0,Object.assign(s.value,t),F(()=>{w.value.clearValidate("name"),w.value.clearValidate("username"),w.value.clearValidate("password")})},Q=()=>{b.value=!0,Object.assign(s.value,{username:"",password:"",name:""}),F(()=>{w.value.clearValidate("name"),w.value.clearValidate("username"),w.value.clearValidate("password")})},W=async t=>{t&&(await t.validate(async(e,n)=>{e?(b.value=!1,(await ke(s.value)).code===200?(g({type:"success",message:s.value.id?"修改成功":"添加成功"}),s.value.id&&window.location.reload()):g({type:"error",message:s.value.id?"修改失败":"添加失败"})):console.log("有失败",n)}),await _(m.value,p.value))},X=()=>{b.value=!1},Y=async t=>{k.value=!0,Object.assign(s.value,t);let e=await Ve(t.id);e.code===200?($.value=e.data.allRolesList,x.value=e.data.assignRoles.map(n=>n.id)):g({type:"error",message:e.message})},ee=()=>{k.value=!1},ae=async()=>{const t={roleIdList:x.value,userId:s.value.id};let e=await Ce(t);e.code===200?g({type:"success",message:e.message}):g({type:"error",message:e.message}),k.value=!1,await _(m.value,p.value)},le=t=>{x.value=t?$.value.map(e=>e.id):[],U.value=!1},te=t=>{const e=t.length;C.value=e===$.value.length,U.value=e>0&&e<$.value.length},oe=async t=>{let e=await xe(t.id);e.code===200?g({type:"success",message:e.message}):g({type:"error",message:e.data??e.message}),await _(m.value,p.value)},z=r([]),se=t=>{z.value=t.map(e=>e.id),console.log(t)},ne=r(),re=async()=>{let t=await Ue(z.value);t.code===200?g({type:"success",message:t.message}):g({type:"error",message:t.data??t.message}),await _(m.value,p.value),z.value=[]},ue=async()=>{await _(m.value,p.value,h.value)},de=async()=>{h.value="",await _(m.value,p.value)};return(t,e)=>{const n=v("el-input"),i=v("el-form-item"),f=v("el-button"),R=v("el-form"),I=v("el-card"),y=v("el-table-column"),ie=v("el-popconfirm"),ce=v("el-table"),me=v("el-pagination"),N=v("el-drawer"),E=v("el-checkbox"),pe=v("el-checkbox-group");return S(),j(B,null,[a(I,{style:{margin:"10px 0px",height:"75px"}},{default:l(()=>[a(R,{inline:!0,class:"el-form-search"},{default:l(()=>[a(i,{label:"用户名:"},{default:l(()=>[a(n,{placeholder:"请输入搜索用户名",modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=q=>h.value=q)},null,8,["modelValue"])]),_:1}),a(i,null,{default:l(()=>[a(f,{type:"primary",disabled:!h.value,onClick:ue},{default:l(()=>[c("搜索")]),_:1},8,["disabled"]),a(f,{onClick:de},{default:l(()=>[c("重置")]),_:1})]),_:1})]),_:1})]),_:1}),a(I,null,{default:l(()=>{var q,P;return[a(f,{type:"primary",onClick:Q},{default:l(()=>[c("添加用户")]),_:1}),a(f,{type:"primary",onClick:re,disabled:z.value.length===0},{default:l(()=>[c("批量删除")]),_:1},8,["disabled"]),a(ce,{style:{margin:"10px 0px"},border:"",data:(q=u(D))==null?void 0:q.records,ref_key:"table1",ref:ne,onSelectionChange:se},{default:l(()=>[a(y,{type:"selection",align:"center"}),a(y,{type:"index",label:"#",align:"center"}),a(y,{label:"ID",align:"center",prop:"id"}),a(y,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":!0}),a(y,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":!0}),a(y,{label:"用户职位",align:"center",prop:"roleName","show-overflow-tooltip":!0}),a(y,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":!0}),a(y,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":!0}),a(y,{label:"操作",width:"360px"},{default:l(o=>[a(f,{type:"primary",icon:"User",size:"small",onClick:T=>Y(o.row)},{default:l(()=>[c(" 分配角色 ")]),_:2},1032,["onClick"]),a(f,{type:"primary",icon:"Edit",size:"small",onClick:T=>H(o.row)},{default:l(()=>[c("编辑")]),_:2},1032,["onClick"]),a(ie,{title:"确定要删除吗",onConfirm:T=>oe(o.row)},{reference:l(()=>[a(f,{type:"primary",icon:"Delete",size:"small"},{default:l(()=>[c("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),A("div",he,[a(me,{"current-page":m.value,"onUpdate:currentPage":e[1]||(e[1]=o=>m.value=o),"page-size":p.value,"onUpdate:pageSize":e[2]||(e[2]=o=>p.value=o),"page-sizes":[5,7,9,11],disabled:Z.value,background:M.value,layout:" prev, pager, next, jumper,->, sizes,total",total:(P=u(D))==null?void 0:P.total,onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","disabled","background","total"])]),a(N,{modelValue:u(b),"onUpdate:modelValue":e[7]||(e[7]=o=>L(b)?b.value=o:b=o),title:u(s).id?"修改用户信息":"添加用户信息","lock-scroll":!0,direction:"rtl"},{default:l(()=>[a(R,{model:u(s),rules:G,ref_key:"Reftable",ref:w},{default:l(()=>[a(i,{label:"用户名字",prop:"username"},{default:l(()=>[a(n,{placeholder:"请输入用户名字",modelValue:u(s).username,"onUpdate:modelValue":e[3]||(e[3]=o=>u(s).username=o)},null,8,["modelValue"])]),_:1}),a(i,{label:"用户昵称",prop:"name"},{default:l(()=>[a(n,{placeholder:"请输入用户昵称",modelValue:u(s).name,"onUpdate:modelValue":e[4]||(e[4]=o=>u(s).name=o)},null,8,["modelValue"])]),_:1}),u(s).id?ge("",!0):(S(),O(i,{key:0,label:"用户密码",prop:"password"},{default:l(()=>[a(n,{placeholder:"请输入用户密码",modelValue:u(s).password,"onUpdate:modelValue":e[5]||(e[5]=o=>u(s).password=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:l(()=>[A("div",null,[a(f,{onClick:X},{default:l(()=>[c("取消")]),_:1}),a(f,{type:"primary",onClick:e[6]||(e[6]=o=>W(w.value))},{default:l(()=>[c("确定")]),_:1})])]),_:1},8,["modelValue","title"]),a(N,{modelValue:u(k),"onUpdate:modelValue":e[13]||(e[13]=o=>L(k)?k.value=o:k=o),title:"分配角色","lock-scroll":!0,direction:"rtl"},{default:l(()=>[a(R,{model:u(s)},{default:l(()=>[a(i,{label:"用户名字"},{default:l(()=>[a(n,{modelValue:u(s).name,"onUpdate:modelValue":e[8]||(e[8]=o=>u(s).name=o),disabled:!0},null,8,["modelValue"])]),_:1}),a(i,{label:"角色列表"},{default:l(()=>[A("div",$e,[a(E,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=o=>C.value=o),indeterminate:U.value,onChange:e[10]||(e[10]=o=>le(C.value))},{default:l(()=>[c("全选")]),_:1},8,["modelValue","indeterminate"]),a(pe,{modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=o=>x.value=o),onChange:e[12]||(e[12]=o=>te(x.value))},{default:l(()=>[(S(!0),j(B,null,_e($.value,o=>(S(),O(E,{key:o.id,label:o.id},{default:l(()=>[c(ye(o.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),footer:l(()=>[A("div",null,[a(f,{onClick:ee},{default:l(()=>[c("取消")]),_:1}),a(f,{type:"primary",onClick:ae},{default:l(()=>[c("确定")]),_:1})])]),_:1},8,["modelValue"])]}),_:1})],64)}}});const De=be(qe,[["__scopeId","data-v-310058ce"]]);export{De as default};
